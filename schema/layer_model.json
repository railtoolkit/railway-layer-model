{
  "$id": "https://railtoolkit.org/layer-model/schema/layer_model.json",
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "title": "Railway Layer Model",
  "description":
    "The railway layer model is part of a PhD thesis. Copyright (c) 2018 - 2023, Martin Scheidt [m.scheidt@tu-bs.de] under the ISC License. This schema can be used to verify the YAML snippets for railway layer model. First cycle of DSR only includes the base layer",
  "type": "object",
  "anyOf": [
    {"required": [ "base" ] },
    {"required": [ "network" ] },
    {"required": [ "physical" ] },
    {"required": [ "speed" ] },
    {"required": [ "interlocking" ] },
    {"required": [ "resource" ] },
    {"required": [ "transit" ] },
    {"required": [ "transport" ] }
  ],
  "$defs": {
    "id": {
      "type": "string",
      "description": "might be a UUID or something similar"
    },
    "name": {
      "type": "string",
      "description": "a human readable string of an element, node, or object"
    },
    "switch_branches": {
      "type": "string",
      "enum": [ "diverging", "diverging2", "straight", "straight2" ]
    },
    "mileage": {
      "type": "number",
      "default": 0,
      "description": "the mileage in kilometer; e.g. 0.050 are 50 meters"
    },
    "line_position": {
      "type": "array",
      "items": {
        "type": "object",
        "properties": {
          "line": { "type": "string" },
          "mileage": { "$ref": "#/$defs/mileage" }
        },
        "required": [ "line", "mileage" ]
      }
    },
    "network_node": {
      "type": "array",
      "items": {
        "type": "object",
        "required": [ "track", "limit" ],
        "properties": {
          "track": { "$ref": "#/$defs/resource_reference" },
          "limit": {
            "type": "object",
            "required": [ "name" ],
            "properties": {
              "name": { "type": "string" },
              "physical_ref": { "$ref": "#/$defs/physical_reference" }
            }
          }
        }
      }
    },
    "tracksection": {
      "type": "array",
      "items": {
        "type": "object",
        "required": [ "id", "physical_ref", "breaking_distance", "clearing_distance" ],
        "properties": {
          "id": { "$ref": "#/$defs/id" },
          "physical_ref": {
            "type": "array",
            "items": { "$ref": "#/$defs/physical_reference" }
          },
          "breaking_distance": { "$ref": "#/$defs/length" },
          "clearing_distance": { "$ref": "#/$defs/length" }
        }
      }
    },
    "berth": {
      "type": "object",
      "required": [ "name", "physical_ref", "platform", "usable" ],
      "properties": {
        "name": { "type": "string" },
        "physical_ref": { "$ref": "#/$defs/physical_reference" },
        "platform": { "type": "boolean" },
        "usable": {
          "type": "array",
          "items": {
            "type": "object",
            "required": [ "length", "occupied_sections" ],
            "properties": {
              "length": { "$ref": "#/$defs/length" },
              "occupied_sections": {
                "type": "array",
                "items": {
                  "$ref": "#/$defs/id",
                  "describtion": "tracksection id"
                }
              }
            }
          }
        }
      }
    },
    "base_reference": {
      "type": "string",
      "description": "ID of a station from base layer"
    },
    "network_reference": {
      "type": "string",
      "description": "ID of a station from network layer"
    },
    "physical_reference": {
      "type": "string",
      "description": "ID of a element from physical layer"
    },
    "resource_reference": {
      "type": "string",
      "description": "ID of a element from resource layer"
    },
    "direction": {
      "type": "string",
      "enum": [ "forward", "backward", "bidirectional" ]
    },
    "length": {
      "type": "number",
      "default": 0,
      "minimum": 0,
      "description": "the physical distance between two nodes"
    },
    "duration": {
      "type": "number",
      "default": 0,
      "minimum": 0,
      "description": "a duration in seconds; e.g. 2.0 are 2 seconds"
    },
    "time": {
      "type": "string",
      "default": "00:00:00",
      "pattern": "[0-1][0-9]|2[0-3]:[0-5][0-9]:[0-5][0-9]",
      "description": "Time stamp with HH:MM:SS"
    },
    "date": {
      "type": "string",
      "default": "1900-01-01",
      "format": "date",
      "description": "Date with yyyy-mm-dd"
    },
    "velocity": {
      "type": "number",
      "default": 0,
      "minimum": 0,
      "description": "velocity in km/h"
    },
    "speed": {
      "items": {
        "type": "object",
        "required": [ "name", "parent", "speed_limit" ],
        "properties": {
          "name": { "type": "string", "default": "default" },
          "parent": { "type": "string", "default": "none" },
          "speed_limit": { "$ref": "#/$defs/velocity" }
        }
      }
    }
  },
  "properties": {
    "base": {
      "title": "base layer",
      "type": "object",
      "description": "macroscopic connections & network access",
      "properties": {
        "name": { "type": "string" },
        "id": { "$ref": "#/$defs/id" },
        "required": [ "lines", "locations" ],
        "locations": {
          "type": "array",
          "items": {
            "type": "object",
            "properties": {
              "id": { "$ref": "#/$defs/id" },
              "name": { "type": "string" },
              "plot_coord": {
                "type": "array",
                "items": {}
              },
              "geo_coord": {
                "type": "array",
                "items": {}
              },
              "pos": { "$ref": "#/$defs/line_position" }
            },
            "required": [ "id", "name" ]
          }
        },
        "relations": {
          "type": "array",
          "required": [ "source", "target" ],
          "items": {
            "type": "object",
            "properties": {
              "id": {
                "type": "string"
              },
              "label": {
                "type": "string"
              },
              "source": {
                "description": "$id of a station",
                "type": "string"
              },
              "target": {
                "description": "$id of a station",
                "type": "string"
              },
              "length": { "$ref": "#/$defs/length" }
            }
          }
        },
        "lines": {
          "type": "array",
          "items": {
            "type": "object",
            "required": [ "id" ],
            "properties": {
              "name": { "type": "string" },
              "id": { "$ref": "#/$defs/id" },
              "start": { "$ref": "#/$defs/mileage" },
              "end": { "$ref": "#/$defs/mileage" },
              "mileage_jump": { "type": "null" },
              "locations": {
                "type": "array",
                "items": {
                  "type": "string",
                  "description": "location ID"
                }
              },
              "conjunctions": {
                "items": {
                  "required": [ "location", "line" ],
                  "properties": {
                    "location": { "type": "string" },
                    "line": { "type": "string" }
                  }
                }
              }
            }
          }
        }
      }
    },
    "network": {
      "type": "object",
      "title": "The Network Layer",
      "description": "junctions, tracks & usage",
      "required": [ "junctions" ],
      "properties": {
        "name": { "type": "string" },
        "id": { "$ref": "#/$defs/id" },
        "junctions": {
          "type": "array",
          "items": {
            "type": "object",
            "required": [ "id" ],
            "properties": {
              "id": { "$ref": "#/$defs/id" },
              "base_ref": { "$ref": "#/$defs/base_reference" },
              "in": { "$ref": "#/$defs/network_node" },
              "out": { "$ref": "#/$defs/network_node" }
            }
          }
        },
        "links": {
          "type": "array",
          "items": {
            "type": "object",
            "required": [ "id", "source", "target", "type" ],
            "properties": {
              "id": { "$ref": "#/$defs/id" },
              "source": {
                "$ref": "#/$defs/id",
                "description": "element ID"
              },
              "target": {
                "$ref": "#/$defs/id",
                "description": "element ID"
              },
              "type": {
                "type": "string",
                "enum": [ "passage", "site" ]
              }
            }
          }
        }
      }
    },
    "physical": {
      "title": "physical layer",
      "type": "object",
      "description": "microscopic connections & topology",
      "properties": {
        "id": { "$ref": "#/$defs/id" },
        "elements": {
          "type": "array",
          "items": {
            "type": "object",
            "required": [ "name", "class", "kind" ],
            "properties": {
              "name": { "type": "string" },
              "base_ref": { "$ref": "#/$defs/base_reference" },
              "network_ref": { "$ref": "#/$defs/network_reference" },
              "id": { "$ref": "#/$defs/id" },
              "pos": { "$ref": "#/$defs/line_position" },
              "class": { 
                "type": "string",
                "enum": [ "berth", "sign", "branching", "trap", "detector", "end" ]
              },
              "specimen": { "type": "string" }
            },
            "allOf": [
              {
                "if": {  "properties": { "class": { "const": "berth" } } },
                "then": {
                  "properties": {
                    "kind": { "type": "string", "enum": ["end platform", "end usable length"] },
                    "direction": { "$ref": "#/$defs/direction" }
                  }
                }
              }, {
                "if": { "properties": { "class": { "const": "sign" } } },
                "then": {
                  "properties": {
                    "kind": { "type": "string", "enum": ["board", "signal"] },
                    "direction": { "$ref": "#/$defs/direction" }
                  }
                }
              }, {
                "if": { "properties": { "class": { "const": "trap" } } },
                "then": {
                  "properties": {
                    "kind": { "type": "string", "enum": ["derailer", "points"] },
                    "direction": { "$ref": "#/$defs/direction" }
                  }
                }
              }, {
                "if": { "properties": { "class": { "const": "branching" } } },
                "then": {
                  "properties": {
                    "kind": { "type": "string", "enum": ["turnout", "slip turnout", "diamond crossing"] },
                    "branches": {
                      "type": "array",
                      "items": {
                        "type": "object",
                        "required": [ "name", "path" ],
                        "properties": {
                          "name": { "$ref": "#/$defs/switch_branches" },
                          "path": {
                            "type": "array",
                            "maxItems" : 2,
                            "minItems" : 2,
                            "items": {
                              "$ref": "#/$defs/id",
                              "description": "tracksegment ID"
                            }
                          },
                          "speed": { "$ref": "#/$defs/speed" }
                        }
                      }
                    }
                  }
                }
              }, {
                "if": { "properties": { "class": { "const": "detector" } } },
                "then": {
                  "properties": {
                    "kind": { "type": "string", "enum": ["clearing point", "balise"] },
                    "direction": { "$ref": "#/$defs/direction" }
                  }
                }
              }, {
                "if": {  "properties": { "class": { "const": "end" } } },
                "then": {
                  "properties": {
                    "kind": { "type": "string", "enum": ["buffer stop", "continuing"] }
                  }
                }
              }
            ]
          }
        },
        "segments": {
          "type": "array",
          "items": {
            "type": "object",
            "required": [ "id", "source", "target" ],
            "properties": {
              "name": { "type": "string" },
              "id": { "$ref": "#/$defs/id" },
              "length": { "$ref": "#/$defs/length" },
              "base_ref": { "$ref": "#/$defs/base_reference" },
              "source": {
                "$ref": "#/$defs/id",
                "description": "element ID"
              },
              "target": {
                "$ref": "#/$defs/id",
                "description": "element ID"
              }
            }
          }
        }
       }
    },
    "speed": {
      "title": "speed profile layer",
      "type": "array",
      "description": "track attributes & running time estimation",
      "items": {
        "type": "object",
        "anyOf": [
          {"required": [ "id", "start", "end", "allowance"] },
          {"required": [ "id", "start", "end", "gradient_changes"] },
          {"required": [ "id", "start", "end", "radius_changes"] }
        ],
        "properties": {
          "name": { "type": "string" },
          "line": { "type": "string" },
          "track": { "type": "string" },
          "start": { "type": "number" },
          "end": { "type": "number" },
          "direction": { "$ref": "#/$defs/direction" },
          "id": { "$ref": "#/$defs/id" },
          "path": {
            "type": "array",
            "items": { "$ref": "#/$defs/network_reference" }
          },
          "allowance": {
            "type": "array",
            "default": [],
            "title": "The allowance Schema",
            "minItems" : 1,
            "items": {
              "type": "object",
              "title": "A Schema",
              "required": [ "pos", "speed" ],
              "properties": {
                "pos": { "$ref": "#/$defs/line_position" },
                "speed": { "$ref": "#/$defs/speed" }
              }
            }
          },
          "gradient_changes": {
            "type": "array",
            "items": {
              "type": "object",
              "required": [ "pos", "slope", "elevation" ],
              "properties": {
                "pos": { "$ref": "#/$defs/line_position" },
                "slope": {
                  "type": "number",
                  "default": 0.0,
                  "description": "in permil (‰)"
                },
                "elevation": {
                  "type": "number",
                  "default": 0.0
                },
                "length": {
                  "type": "number",
                  "description": "length of the radius of curvature"
                },
                "radius": { "type": "number" }
              }
            }
          },
          "radius_changes": {
            "type": "array",
            "default": [],
            "title": "The radius_changes Schema",
            "minItems" : 1,
            "items": {
              "type": "object",
              "title": "A Schema",
              "required": [ "pos", "class" ],
              "properties": {
                "pos": { "$ref": "#/$defs/line_position" },
                "class": {
                  "type": "string",
                  "enum": [ "const", "varying" ]
                }
              },
              "allOf": [
                {
                  "if": {  "properties": { "class": { "const": "const" } } },
                  "then": {
                    "properties": {
                      "radius": {
                        "type": "number",
                        "default": ".Inf",
                        "description": "positive -> left curvature / negative -> right curvature"
                      }
                    }
                  }
                },
                {
                  "if": {  "properties": { "class": { "const": "varying" } } },
                  "then": {
                    "properties": {
                      "type": {
                        "type": "string",
                        "default": "linear"
                      }
                    }
                  }
                }
              ]
            }
          }
        }
      }
    },
    "interlocking": {
      "title": "interlocking layer",
      "description": "signalling & safety",
      "type": "array",
      "items": {
        "type": "object",
        "required": [ "physical_ref", "network_ref", "breaking_distance", "overlaps", "routes" ],
        "properties": {
          "entrance_name": { "type": "string" },
          "physical_ref": { "$ref": "#/$defs/physical_reference" },
          "network_ref": { "$ref": "#/$defs/network_reference" },
          "breaking_distance": { "$ref": "#/$defs/mileage" },
          "overlaps": {
            "type": "array",
            "items": {
              "type": "object",
              "title": "A Schema",
              "required": [ "id", "end" ],
              "properties": {
                "id": {
                  "$ref": "#/$defs/id",
                  "default": "main",
                  "description": "id for the overlap to select"
                },
                "end": {
                  "type": "array",
                  "items": {
                    "type": "object",
                    "required": [ "physical_ref" ],
                    "properties": {
                      "name": { "$ref": "#/$defs/name" },
                      "physical_ref": { "$ref": "#/$defs/physical_reference" }
                    }
                  }
                },
                "en_route": {
                  "type": "array",
                  "title": "The en_route Schema",
                  "items": {
                    "type": "object",
                    "title": "A Schema",
                    "required": [ "physical_ref", "branch" ],
                    "properties": {
                      "name": {
                        "type": "string",
                        "title": "The name Schema"
                      },
                      "physical_ref": { "$ref": "#/$defs/physical_reference" },
                      "branch": {
                        "type": "string"
                      }
                    }
                  }
                },
                "flankprotection": {
                  "type": "object",
                  "title": "The flankprotection Schema",
                  "anyOf": [
                    {"required": [ "turnouts" ] },
                    {"required": [ "signals" ] }
                  ],
                  "properties": {
                    "turnouts": {
                      "type": "array",
                      "items": {
                        "type": "object",
                        "title": "A Schema",
                        "required": [ "physical_ref", "branches" ],
                        "properties": {
                          "name": { "$ref": "#/$defs/name" },
                          "physical_ref": { "$ref": "#/$defs/physical_reference" },
                          "branches": {
                            "type": "array",
                            "items": { "type": "string" }
                          }
                        }
                      }
                    },
                    "signals": {
                      "type": "array",
                      "items": {
                        "type": "object",
                        "required": [ "physical_ref" ],
                        "properties": {
                          "name": { "$ref": "#/$defs/name" },
                          "physical_ref": { "$ref": "#/$defs/physical_reference" }
                        }
                      }
                    }
                  }
                },
                "speed_restriction": { "$ref": "#/$defs/velocity" }
              }
            }
          },
          "routes": {
            "type": "array",
            "items": {
              "type": "object",
              "title": "A Schema",
              "required": [ "id", "target", "en_route", "flankprotection", "route_clearing" ],
              "properties": {
                "id": {
                  "$ref": "#/$defs/id",
                  "default": "main",
                  "description": "id for the route to select"
                },
                "target": { "$ref": "#/$defs/network_reference" },
                "en_route": {
                  "type": "array",
                  "items": {
                    "type": "object",
                    "required": [ "physical_ref", "branch" ],
                    "properties": {
                      "name": { "$ref": "#/$defs/name" },
                      "physical_ref": { "$ref": "#/$defs/physical_reference" },
                      "branch": { "$ref": "#/$defs/switch_branches" }
                    }
                  }
                },
                "flankprotection": {
                  "type": "object",
                  "anyOf": [
                    {"required": [ "turnouts" ] },
                    {"required": [ "signals" ] }
                  ],
                  "properties": {
                    "turnouts": {
                      "type": "array",
                      "items": {
                        "type": "object",
                        "title": "A Schema",
                        "required": [ "name", "physical_ref", "branches" ],
                        "properties": {
                          "name": { "$ref": "#/$defs/name" },
                          "physical_ref": { "$ref": "#/$defs/physical_reference" },
                          "branches": {
                            "type": "array",
                            "items": { "$ref": "#/$defs/switch_branches" }
                          },
                          "optional_transfer_to": {
                            "type": { "$ref": "#/$defs/name" },
                            "description": "name of the element the flankprotection can be transfered to"
                          }
                        }
                      }
                    },
                    "signals": {
                      "type": "array",
                      "items": {
                        "type": "object",
                        "required": [ "name", "physical_ref" ],
                        "properties": {
                          "name": { "$ref": "#/$defs/name" },
                          "physical_ref": { "$ref": "#/$defs/physical_reference" },
                          "optional_transfer_from": {
                            "type": { "$ref": "#/$defs/name" },
                            "description": "name of the element where a flankprotection can be transfered from"
                          },
                          "permitted_overlap": {
                            "$ref": "#/$defs/id",
                            "description": "id for the overlap to select"
                          }
                        }
                      }
                    }
                  }
                },
                "route_clearing": {
                  "type": "object",
                  "required": [ "physical_ref" ],
                  "properties": {
                    "name": { "$ref": "#/$defs/name" },
                    "physical_ref": { "$ref": "#/$defs/physical_reference" }
                  }
                }
              }
            }
          }
        }
      }
    },
    "resource": {
      "title": "resource layer",
      "description": "queue network",
      "type": "object",
      "anyOf": [
        {"required": [ "sites" ] },
        {"required": [ "passages" ] }
      ],
      "properties": {
        "sites": {
          "type": "array",
          "items": {
            "type": "object",
            "required": [ "id", "base_ref", "sets", "tracks" ],
            "properties": {
              "id": { "$ref": "#/$defs/network_reference" },
              "name": { "type": "string" },
              "base_ref": { "$ref": "#/$defs/base_reference" },
              "sets": {
                "type": "array",
                "description": "arrays of arrays of track id's",
                "items": {
                  "type": "array",
                  "items": { "$ref": "#/$defs/id" }
                }
              },
              "tracks": {
                "type": "array",
                "items": {
                  "type": "object",
                  "required": [ "id", "line", "line_track", "sections", "berths" ],
                  "properties": {
                    "id": { "$ref": "#/$defs/id" },
                    "line": { "type": "string" },
                    "line_track": { "type": "string" },
                    "main_direction": {
                      "$ref": "#/$defs/direction",
                      "default": "bidirectional"
                    },
                    "opposite_direction_usable": {
                      "type": "boolean",
                      "default": true
                    },
                    "sections": { "$ref": "#/$defs/tracksection" },
                    "berths": {
                      "type": "object",
                      "required": [ "forward", "backward" ],
                      "properties": {
                        "forward": {
                          "type": "array",
                          "items": { "$ref": "#/$defs/berth" }
                        },
                        "backward": {
                          "type": "array",
                          "items": { "$ref": "#/$defs/berth" }
                        }
                      }
                    }
                  }
                }
              }
            }
          }
        },
        "passages": {
          "type": "array",
          "items": {
            "type": "object",
            "required": [ "id", "base_ref", "tracks" ],
            "properties": {
              "id": { "$ref": "#/$defs/network_reference" },
              "name": { "type": "string" },
              "base_ref": { "$ref": "#/$defs/base_reference" },
              "tracks": {
                "type": "array",
                "items": {
                  "type": "object",
                  "title": "A Schema",
                  "required": [ "id", "line", "line_track", "sections" ],
                  "properties": {
                    "id": { "$ref": "#/$defs/id" },
                    "line": { "type": "string" },
                    "line_track": { "type": "string" },
                    "main_direction": {
                      "$ref": "#/$defs/direction",
                      "default": "bidirectional"
                    },
                    "opposite_direction_usable": {
                      "type": "boolean",
                      "default": true
                    },
                    "sections": { "$ref": "#/$defs/tracksection" }
                  }
                }
              }
            }
          }
        }
      }
    },
    "transit": {
      "title": "transit layer",
      "description": "slots, halts, headway, vehicles",
      "type": "object",
      "anyOf": [
        {"required": [ "slots" ] },
        {"required": [ "pulses" ] },
        {"required": [ "snippets", "vehicles", "formations"  ] }
      ],
      "properties": {
        "slots": {
            "type": "null"
        },
        "pulses": {
            "type": "null"
        },
        "snippets": {
          "type": "array",
          "items": {
            "type": "object",
            "required": [ "id", "direction", "ingress_type", "egress_type", "push_pre", "core_length", "core_duration" ],
            "properties": {
              "id": { "$ref": "#/$defs/id" },
              "name": {  "type": "string" },
              "description": { "type": "string" },
              "direction": { "$ref": "#/$defs/direction" },
              "push_pre": { "type": "boolean" },
              "ingress_object": {
                "type": "object",
                "anyOf": [
                  {"required": [ "physical_ref"] },
                  {"required": [ "associated"] }
                ],
                "properties": {
                  "name": { "type": "string" },
                  "physical_ref": { "$ref": "#/$defs/physical_reference" },
                  "associated": { "type": "string" }
                }
              },
              "egress_object": {
                "type": "object",
                "anyOf": [
                  {"required": [ "physical_ref"] },
                  {"required": [ "associated"] }
                ],
                "properties": {
                  "name": { "type": "string" },
                  "physical_ref": { "$ref": "#/$defs/physical_reference" },
                  "associated": { "type": "string" }
                }
              },
              "ingress_type": {
                "type": "string",
                "enum": [ "pass", "halt" ]
              },
              "egress_type": {
                "type": "string",
                "enum": [ "pass", "halt" ]
              },
              "trigger_duration": {
                "type": "number",
                "default": 0.0,
                "description": "in seconds"
              },
              "pre_duration": {
                "type": "number",
                "default": 0.0,
                "description": "in seconds"
              },
              "core_length": {
                "type": "number",
                "description": "in meter"
              },
              "core_duration": {
                "type": "number",
                "description": "in seconds"
              },
              "post_duration": {
                "type": "number",
                "default": 0.0,
                "description": "in seconds"
              }
            }
          }
        },
        "vehicles": {
          "type": "array",
          "minItems": 1,
          "items": {
            "required": [ "name", "id", "vehicle_type", "length", "mass" ],
            "type": "object",
            "properties": {
              "air_resistance": {
                "description": "coefficient for air resistance in permil",
                "type": "number",
                "exclusiveMinimum": 0
              },
              "base_resistance": {
                "description": "coefficient for basic resistance in permil",
                "type": "number",
                "exclusiveMinimum": 0
              },
              "id": {
                "description": "Identifier of the vehicle",
                "type": "string"
              },
              "length": {
                "description": "The length of the vehicle in meter",
                "type": "number",
                "exclusiveMinimum": 0
              },
              "load_limit": {
                "description": "The maximum permitted load of the vehicle in metric ton",
                "type": "number",
                "exclusiveMinimum": 0
              },
              "mass_traction": {
                "description": "The mass on the powered axles of the vehicle in metric ton",
                "type": "number",
                "exclusiveMinimum": 0
              },
              "mass": {
                "description": "The empty mass of the vehicle in metric ton",
                "type": "number",
                "exclusiveMinimum": 0
              },
              "name": {
                "description": "Name of the vehicle",
                "type": "string"
              },
              "picture": {
                "description": "A URI with a picture for humans",
                "type": "string",
                "format": "uri"
              },
              "power_type": {
                "description": "Type of propulsion",
                "enum": [ "diesel", "electric", "steam" ]
              },
              "rolling_resistance": {
                "description": "coefficient for resistance of rolling axles in permil",
                "type": "number",
                "exclusiveMinimum": 0
              },
              "rotation_mass": {
                "description": "Factor for rotating mass; >= 1",
                "type": "number",
                "minimum": 1
              },
              "speed_limit": {
                "description": "Maximum permitted speed in kilometers per hour",
                "type": "number",
                "exclusiveMinimum": 0
              },
              "tractive_effort": {
                "description": "Tractive effort as pairs of speed in kilometers per hour and tractive force in newton",
                "type": "array",
                "minItems": 3,
                "uniqueItems": true,
                "items": {
                  "type": "array",
                  "minItems": 2,
                  "maxItems": 2,
                  "uniqueItems": true,
                  "items": {
                    "type": "number",
                    "minimum": 0
                  }
                }
              },
              "UUID": {
                "description": "The unique identifier for a vehicle",
                "type": "string",
                "format": "uuid"
              },
              "vehicle_type": {
                "description": "Type of vehicle",
                "enum": [ "traction unit", "freight", "passenger", "multiple unit" ]
              }
            }
          }
        },
        "formations": {
          "type": "array",
          "minItems": 1,
          "items": {
            "required": [ "name", "id", "formation" ],
            "type": "object",
            "properties": {
              "id": {
                "description": "Identifier of the train",
                "type": "string"
              },
              "name": {
                "description": "Name of the train",
                "type": "string"
              },
              "UUID": {
                "description": "The unique identifier for a train",
                "type": "string",
                "format": "uuid"
              },
              "formation": {
                "description": "Collection of vehicles that form the train",
                "type": "array",
                "minItems": 1,
                "uniqueItems": false,
                "items": {
                  "type": "string"
                }
              }
            }
          }
        }
      }
    },
    "transport": {
      "title": "transport layer",
      "description": "services, intervals, trains",
      "type": "object",
      "required": [ "periods", "runs", "services", "trains" ],
      "properties": {
        "periods": {
          "type": "array",
          "items": {
            "type": "object",
            "required": [ "id", "name", "startdate", "enddate", "bitmask" ],
            "properties": {
              "id": { "$ref": "#/$defs/id" },
              "name": { "type": "string" },
              "startdate": { "$ref": "#/$defs/date" },
              "enddate": { "$ref": "#/$defs/date" },
              "bitmask": {
                "type": "string",
                "default": "0",
                "description": "Every bit represents a Day between 'startdate' and 'enddate' (including); 1: train runs on this day - 0: train does not run",
                "pattern": "[0-1]*"
              }
            }
          }
        },
        "runs": {
          "type": "array",
          "items": {
            "type": "object",
            "required": [ "id", "train_data", "running_path" ],
            "properties": {
              "id": { "$ref": "#/$defs/id" },
              "train_formation": {
                "$ref": "#/$defs/id",
                "description": "train_formation ID from transit layer"
              },
              "running_path": {
                "type": "array",
                "items": {
                  "type": "object","anyOf": [
                    {"required": [ "sequence", "link", "track", "route", "type", "margin" ] },
                    {"required": [ "sequence", "link", "track", "route", "type", "arrival", "snippet_in", "margin" ] },
                    {"required": [ "sequence", "link", "track", "route", "type", "departure", "snippet_out", "margin" ] },
                    {"required": [ "sequence", "link", "track", "route", "type", "arrival", "departure", "snippet_in", "snippet_out", "margin" ] }
                  ],
                  "properties": {
                    "sequence": {
                      "type": "integer",
                      "minimum": 1 
                    },
                    "link": {
                      "$ref": "#/$defs/id",
                      "description": "track ID from network layer"
                    },
                    "track": {
                      "$ref": "#/$defs/id",
                      "description": "track ID from network layer"
                    },
                    "route": {
                      "$ref": "#/$defs/id",
                      "description": "route ID from interlocking layer",
                      "default": "main"
                    },
                    "type": {
                      "type": "string",
                      "enum": [ "start", "pass", "stop" ]
                    },
                    "arrival": { "$ref": "#/$defs/duration" },
                    "departure":  { "$ref": "#/$defs/duration" },
                    "margin": { "$ref": "#/$defs/duration" },
                    "snippet_out": {
                      "$ref": "#/$defs/id",
                      "description": "snippet ID from transit layer"
                    },
                    "snippet_in": {
                      "$ref": "#/$defs/id",
                      "description": "snippet ID from transit layer"
                    }
                  }
                }
              }
            }
          }
        },
        "services": {
          "type": "array",
          "items": {
            "type": "object",
            "title": "A Schema",
            "required": [ "id", "name", "run", "period", "type", "roster_start", "interval", "cycles", "direction" ],
            "properties": {
              "id": { "$ref": "#/$defs/id" },
              "name": { "type": "string" },
              "run": { "$ref": "#/$defs/id" },
              "period": { "$ref": "#/$defs/id" },
              "type": { "type": "string" },
              "roster_start": {
                "$ref": "#/$defs/time",
                "description": "first start time of the cycle"
              },
              "interval": {
                "$ref": "#/$defs/time",
                "description": "time between first an next cycle"
              },
              "cycles": {
                "type": "integer",
                "default": 1,
                "minimum": 1
              },
              "direction": {
                "type": "string",
                "enum": [ "forward", "backward" ]
              }
            }
          }
        },
        "courses": {
          "type": "array",
          "items": {
            "type": "object",
            "title": "A Schema",
            "required": [ "id", "service", "cycle" ],
            "properties": {
              "id": { "$ref": "#/$defs/id" },
              "service": { "$ref": "#/$defs/id" },
              "cycle": {
                "type": "integer",
                "description": "counting up for the course in the service"
              },
              "company": { "type": "string"}
            }
          }
        },
        "connections": {
          "type": "array",
          "items": {
            "type": "object",
            "required": [ "id", "link", "type", "source", "target", "minimum_duration" ],
            "properties": {
              "id": { "$ref": "#/$defs/id" },
              "link": {
                "$ref": "#/$defs/id",
                "description": "link ID from network layer"
              },
              "type": {
                "type": "string",
                "enum": [ "transportation", "vehicle", "resource" ],
                "description": "transportation (connections for passengers or goods) OR vehicle (connections for turnaround or rotation)"
              },
              "source": { "type": "string" },
              "target": { "type": "string" },
              "minimum_duration": { "$ref": "#/$defs/duration" }
            }
          }
        }
      }
    }
  }
}
